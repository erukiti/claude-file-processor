# ファイルプロセッサの設計ドキュメント

## 概要
このツールは、ChatGPTやClaude等のAIサービスで生成されたコードファイルを処理するためのユーティリティです。
特定のフォーマットで結合されたファイルを個別のファイルに展開する機能と、複数のファイルを特定のフォーマットに結合する機能を提供します。

## アーキテクチャ

### コアモジュール
- `processor.ts`: ファイルの展開・結合の主要なロジックを提供
- `processor-utils.ts`: パース処理や文字列フォーマット処理のユーティリティ

### ユーティリティモジュール
- `debug.ts`: デバッグログ出力機能
- `errors.ts`: エラー型の定義
- `file.ts`: ファイル操作のラッパー
- `logger.ts`: ログ出力機能
- `path.ts`: パス操作のユーティリティ
- `security.ts`: セキュリティチェック機能

### CLI
- `cli.ts`: コマンドラインインターフェース
- `types.ts`: 共通の型定義

## セキュリティ考慮事項
1. ディレクトリトラバーサル攻撃の防止
   - 入力されたパスが指定されたディレクトリの外部にアクセスしないようチェック
2. シンボリックリンク制限
   - デフォルトでシンボリックリンクを無効化
3. パス検証
   - ファイルパスのフォーマットを厳密にチェック

## エラーハンドリング
階層化されたエラークラスを使用し、適切なエラーメッセージとコンテキスト情報を提供:
- AppError: 基本エラークラス
- FileOperationError: ファイル操作エラー
- ValidationError: バリデーションエラー
- ParseError: パース処理エラー
- SecurityError: セキュリティ関連エラー

## ロギング
複数レベルのログ出力をサポート:
- ERROR: エラー情報
- WARN: 警告情報
- INFO: 一般情報
- DEBUG: デバッグ情報
- TRACE: 詳細なトレース情報

## テスト戦略
1. ユニットテスト
   - 各モジュールの機能を個別にテスト
   - モックを使用して外部依存を分離
2. 統合テスト
   - 実際のファイルシステムを使用したテスト
   - エラーケースの検証

## 今後の改善点
1. パフォーマンス最適化
   - 大規模ファイルの処理効率化
   - メモリ使用量の最適化
2. 機能拡張
   - 対応フォーマットの追加
   - バッチ処理機能
3. セキュリティ強化
   - ファイル内容の検証機能
   - アクセス制御機能の追加
